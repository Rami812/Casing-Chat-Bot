{% extends "base.html" %}

{% block title %}AI Case Interview Coach - Practice Session{% endblock %}

{% block content %}
<div class="row">
    <!-- Left Panel - Instructions and Progress -->
    <div class="col-lg-4 mb-4">
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-info-circle me-2"></i>
                    Interview Guide
                </h5>
            </div>
            <div class="card-body">
                <!-- Current Stage Indicator -->
                <div class="mb-4">
                    <h6 class="text-muted">Current Stage</h6>
                    <div class="badge bg-secondary" id="current-stage">
                        <i class="bi bi-play-circle me-1"></i>
                        Not Started
                    </div>
                </div>

                <!-- Interview Stages -->
                <h6 class="text-muted mb-3">ðŸ“‹ Interview Stages</h6>
                <div class="list-group list-group-flush">
                    <div class="list-group-item border-0 px-0 py-2">
                        <strong>Stage 1:</strong> Case Introduction
                        <br><small class="text-muted">Listen and ask clarifying questions</small>
                    </div>
                    <div class="list-group-item border-0 px-0 py-2">
                        <strong>Stage 2:</strong> Framework Development
                        <br><small class="text-muted">Create a MECE framework</small>
                    </div>
                    <div class="list-group-item border-0 px-0 py-2">
                        <strong>Stage 3:</strong> Quantitative Analysis
                        <br><small class="text-muted">Perform calculations</small>
                    </div>
                    <div class="list-group-item border-0 px-0 py-2">
                        <strong>Stage 4:</strong> Recommendations
                        <br><small class="text-muted">Provide executive summary</small>
                    </div>
                </div>

                <!-- Tips -->
                <h6 class="text-muted mb-3 mt-4">ðŸ’¡ Tips for Success</h6>
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <strong>Clarifying Questions:</strong> Focus on business context, not specific numbers
                    </li>
                    <li class="mb-2">
                        <strong>Framework:</strong> Use MECE principles (Mutually Exclusive, Collectively Exhaustive)
                    </li>
                    <li class="mb-2">
                        <strong>Math:</strong> Show your work step-by-step with proper rounding
                    </li>
                    <li class="mb-2">
                        <strong>Recommendations:</strong> Speak as if presenting to a CEO
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Right Panel - Chat Interface -->
    <div class="col-lg-8">
        <!-- File Upload Section -->
        <div class="card mb-4" id="upload-section">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="bi bi-upload me-2"></i>
                    Upload Case Study
                </h5>
            </div>
            <div class="card-body text-center">
                <div class="upload-area p-4 border-2 border-dashed border-secondary rounded" id="upload-area">
                    <i class="bi bi-file-pdf display-4 text-muted mb-3"></i>
                    <h5>Upload your case study PDF</h5>
                    <p class="text-muted">Drag and drop your PDF file here, or click to select</p>
                    <input type="file" id="file-input" accept=".pdf" class="d-none">
                    <button type="button" class="btn btn-primary" onclick="document.getElementById('file-input').click()">
                        <i class="bi bi-folder-open me-2"></i>
                        Choose File
                    </button>
                </div>
                <div class="mt-3">
                    <small class="text-muted">Maximum file size: 20MB</small>
                </div>
            </div>
        </div>

        <!-- Chat Interface -->
        <div class="card" id="chat-section" style="display: none;">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="bi bi-chat-dots me-2"></i>
                    Interview Session
                </h5>
            </div>
            <div class="card-body p-0">
                <!-- Chat Messages -->
                <div id="chat-messages" class="chat-container">
                    <!-- Messages will be dynamically added here -->
                </div>
                
                <!-- Chat Input -->
                <div class="border-top p-3">
                    <div class="input-group">
                        <input type="text" id="message-input" class="form-control" 
                               placeholder="Type your message here..." 
                               onkeypress="handleKeyPress(event)">
                        <button class="btn btn-primary" type="button" onclick="sendMessage()">
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                    <small class="text-muted mt-1 d-block">
                        Press Enter to send, or click the send button
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-4">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h5>Processing...</h5>
                <p class="text-muted mb-0" id="loading-message">Please wait while we process your request.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Initialize the application when page loads
document.addEventListener('DOMContentLoaded', function() {
    startSession();
    setupFileUpload();
});

// File upload setup
function setupFileUpload() {
    const uploadArea = document.getElementById('upload-area');
    const fileInput = document.getElementById('file-input');
    
    // Drag and drop functionality
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.classList.add('border-primary', 'bg-light');
    });
    
    uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('border-primary', 'bg-light');
    });
    
    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('border-primary', 'bg-light');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleFileUpload(files[0]);
        }
    });
    
    // File input change
    fileInput.addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            handleFileUpload(e.target.files[0]);
        }
    });
}

// Handle key press in message input
function handleKeyPress(event) {
    if (event.key === 'Enter') {
        sendMessage();
    }
}
</script>
{% endblock %}